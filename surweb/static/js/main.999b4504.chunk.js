(this.webpackJsonpsurweb=this.webpackJsonpsurweb||[]).push([[0],{102:function(e,t,n){},104:function(e,t,n){},132:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(6),s=n.n(c),i=(n(102),n(9)),o=n.n(i),u=n(14),l=n(8),d=(n(104),n(105),n(136)),f=n(16),p=n(10);function b(e,t){return j.apply(this,arguments)}function j(){return(j=Object(u.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var a=new XMLHttpRequest;a.open("GET",t,!0),a.overrideMimeType("text/plain; charset=x-user-defined"),a.addEventListener("error",(function(e){r(new Error("Network error, can't download "+t))})),a.addEventListener("abort",(function(){r(new Error("Request canceled for url "+t))}),!1),a.responseType="arraybuffer",a.onreadystatechange=function(){4===a.readyState&&(200===a.status?(void 0!==n&&n(100),e(new Uint8Array(a.response))):r(new Error("Network error, can't download "+t)))},void 0!==n&&(a.onprogress=function(e){if(e.total&&e.total>0){var t=Math.round(1e4*e.loaded/e.total)/100;n(t)}}),a.send()})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=n(5);function v(){var e=Object(r.useState)({}),t=Object(l.a)(e,2),n=t[0],a=(t[1],Object(r.useRef)(null)),c=Object(r.useState)(null),s=Object(l.a)(c,2),i=s[0],j=s[1],v=Object(r.useState)(0),w=Object(l.a)(v,2),x=w[0],y=w[1],g=Object(r.useState)(null),E=Object(l.a)(g,2),R=E[0],S=E[1],k=Object(r.useState)(!1),L=Object(l.a)(k,2),M=L[0],P=L[1],_=Object(r.useState)(null),A=Object(l.a)(_,2),T=A[0],U=A[1],z=Object(r.useState)(0),I=Object(l.a)(z,2),F=I[0],N=I[1],W=Object(r.useState)(null),B=Object(l.a)(W,2),C=B[0],D=B[1];function H(e){null!==T&&URL.revokeObjectURL(T);var t=new Blob([e],{type:"application/zip"}),n=URL.createObjectURL(t);U(n),m(n)}return Object(r.useEffect)((function(){function e(){return(e=Object(u.a)(o.a.mark((function e(){var t,n,r,a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([b("surmap/surmap.data",y),b("surmap/surmap.wasm"),b("surmap/surmap.js")]);case 2:t=e.sent,n=Object(l.a)(t,3),r=n[0],a=n[1],c=n[2],S({data:r,wasm:a,wasmJs:c});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(function(){return e.apply(this,arguments)})().catch(console.error)}),[]),Object(r.useEffect)((function(){if(null!==a.current){var e=a.current,t=e.parentElement.getBoundingClientRect();j(e),e.width=1280,e.height=720,O(e,t.width,t.height)}}),[a]),Object(r.useEffect)((function(){null!==i&&null!==R&&function(e,t,n,r){return new Promise((function(a,c){try{n.saveZip=r,n.canvas=e,n.getPreloadedPackage=function(e,n){return t.data.buffer},n.instantiateWasm=function(){var e=Object(u.a)(o.a.mark((function e(n,r){var a,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,WebAssembly.compile(t.wasm);case 2:return a=e.sent,e.next=5,WebAssembly.instantiate(a,n);case 5:c=e.sent,r(c,a);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.onRuntimeInitialized=function(){setTimeout((function(){n.callMain([]),a()}),16)};var s=new TextDecoder;new Function(["Module"],s.decode(t.wasmJs))(n)}catch(i){c(i)}}))}(i,R,n,H).then((function(){return P(!0)})).catch(console.error)}),[i,R,n,H]),Object(h.jsxs)("div",{className:"surweb-container",children:[Object(h.jsx)(d.c,{children:Object(h.jsxs)(d.c.Group,{align:f.a.LEFT,children:[Object(h.jsx)(d.c.Heading,{children:"SurWeb"}),Object(h.jsx)(d.c.Divider,{}),M?Object(h.jsxs)("div",{className:"file-container",children:[Object(h.jsx)(d.b,{disabled:null!==C,text:"Select ZIP",onInputChange:function(e){null===i||void 0===i||i.focus();var t=e.currentTarget.files;if(0!==t.length){var r=t[0],a=new FileReader;a.addEventListener("load",function(){var e=Object(u.a)(o.a.mark((function e(t){var r,c,s,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.FS_cwd(),n.FS_chdir(r+"thechain/mirage/"),c=new Uint8Array(a.result),s=n._malloc(c.length),n.HEAPU8.set(c,s),i=n._zip_to_fs(s,c.length),n._free(s),n.FS_chdir(r),0===i?n._reloadWorld():console.error("Unable to extract, retcode",i),D(null);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.addEventListener("progress",(function(e){return N(e.loaded/e.total)})),a.readAsArrayBuffer(r),D(a)}else D(null)}}),"\xa0\xa0",Object(h.jsx)(d.e,{size:16,intent:p.a.PRIMARY,value:F})]}):Object(h.jsxs)(d.c.Heading,{children:["Loading ",x,"%"]}),null!==T?Object(h.jsx)(d.a,{onKeyDown:function(){},minimal:!0,onClick:function(){null===i||void 0===i||i.focus(),null!==T&&m(T)},children:"Download ZIP"}):null]})}),Object(h.jsx)(d.d,{onResize:function(e){null!==i&&O(i,e[0].contentRect.width,e[0].contentRect.height)},children:Object(h.jsxs)("div",{className:"canvas-container",children:[Object(h.jsx)("canvas",{id:"canvas",ref:a,tabIndex:0}),M?null:Object(h.jsx)("div",{className:"spinner-container",children:Object(h.jsx)(d.e,{size:64})})]})})]})}function O(e,t,n){var r=function(e,t,n){if(e/t===n)return[e,t];var r=Math.round(t*n);if(r<=e)return[r,t];var a=Math.round(e/n);return[e,a]}(t,n,1280/720),a=Object(l.a)(r,2),c=a[0],s=a[1];e.style.position="relative",e.style.top=n/2+"px",e.style.left=t/2+"px",e.style.marginTop=s/2*-1+"px",e.style.marginLeft=c/2*-1+"px",e.style.width=c+"px",e.style.height=s+"px"}function m(e){var t=document.createElement("a");t.href=e,t.download="mirage.zip",t.style.display="none",document.body.appendChild(t),t.click(),t.remove()}s.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(v,{})}),document.getElementById("root"))}},[[132,1,2]]]);
//# sourceMappingURL=main.999b4504.chunk.js.map