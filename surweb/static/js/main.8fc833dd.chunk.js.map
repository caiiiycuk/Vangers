{"version":3,"sources":["config.ts","gen.tsx","zip.tsx","landing.tsx","router.tsx","index.tsx","xhr.ts","surweb.tsx","ron.tsx"],"names":["worldFile","palFile","vmpFile","vprFile","bitmapFolder","shapeFolder","Gen","props","useState","palette","setPalette","size","setSize","meshValue","setMeshValue","amplitude","setAmplitude","terainType","setTerainType","initialWorldIni","worldIni","setWorldIni","className","minimal","options","onChange","e","currentTarget","value","min","max","onValueChange","onClick","ini","openGen","large","growVertically","target","Zip","undefined","zipFile","setZipFile","busy","setBusy","a","readContents","zipContents","openZip","href","hasSelection","text","name","files","disabled","file","reader","FileReader","Promise","resolve","reject","addEventListener","event","Uint8Array","result","readAsArrayBuffer","Landing","opened","setOpened","Group","align","Alignment","LEFT","Heading","Divider","interactive","elevation","Elevation","TWO","intent","Intent","PRIMARY","openLastSession","isOpen","AppRouter","route","setRoute","gen","setGen","zip","setZip","setVmp","vmp","getVmp","length","ReactDOM","render","StrictMode","document","getElementById","resolveUrl","url","onProgress","request","XMLHttpRequest","open","overrideMimeType","evt","Error","responseType","onreadystatechange","readyState","status","response","onprogress","total","porgress","Math","round","loaded","send","WIDTH","HEIGHT","SurWeb","module","canvasRef","useRef","canvas","setCanvas","progress","setProgress","binaries","setBinaries","setLoaded","archiveUrl","setArchiveUrl","fileProgress","setFileProgress","setReader","ron","setRon","onArchive","archive","URL","revokeObjectURL","blob","Blob","type","createObjectURL","useEffect","all","dataJs","data","wasm","wasmJs","doLoad","catch","console","error","current","rect","parentElement","getBoundingClientRect","width","height","resizeCanvas","instantiateWasm","then","window","location","reload","onInputChange","focus","bytes","FS","root","cwd","endsWith","unlink","createDataFile","syncfs","err","alert","onKeyDown","downloadUrl","onResize","contentRect","id","ref","tabIndex","lazy","hasBackdrop","Module","close","saveZip","info","receiveInstance","WebAssembly","compile","wasmModule","instantiate","instance","onRuntimeInitialized","instantiateProps","args","setTimeout","callMain","decoder","TextDecoder","Function","decode","moduleFn","chdir","FS_cwd","lookupPath","getPreloadedPackage","buffer","eval","m","enc","TextEncoder","encode","readFile","_malloc","HEAPU8","set","_zip_to_fs","_free","innerWidth","innerHeight","getSizeWithAspectRatio","style","position","top","left","marginTop","marginLeft","targetAspect","calculatedWidth","createElement","download","display","body","appendChild","click","remove","Ron","ronFile","setRonFile","heightFile","setHeightFile","hiFile","setHiFile","loFile","setLoFile","ronUrl","setRonUrl","heightUrl","setHeightUrl","hiUrl","setHiUrl","loUrl","setLoUrl","onFileChange","setFn","hi","lo","ron2vmp","_reloadWorld","_updateZipArchive","vpr","pal","vmp2ron","get_ron_multi_png","get_height_png","get_material_hi_png","get_material_lo_png","log","onInputCapture","icon","rel"],"mappings":"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","file":"static/js/main.8fc833dd.chunk.js","sourcesContent":["export const worldFile = \"thechain/mirage/world.ini\";\nexport const palFile = \"thechain/mirage/harmony.pal\";\nexport const vmpFile = \"thechain/mirage/output.vmp\";\nexport const vprFile = \"thechain/mirage/output.vpr\";\nexport const bitmapFolder = \"bitmap/\";\nexport const shapeFolder = \"shape3d/\";","import {\n\tButton, Callout, HTMLSelect, NumericInput, TextArea\n} from '@blueprintjs/core';\nimport React, { useState } from 'react';\nimport \"./landing.css\";\nimport { AppProps } from './router';\n\nexport function Gen(props: AppProps) {\n\tconst [palette, setPalette] = useState<string>(\"mirage\");\n\tconst [size, setSize] = useState<number>(10);\n\tconst [meshValue, setMeshValue] = useState<number>(50);\n\tconst [amplitude, setAmplitude] = useState<number>(2);\n\tconst [terainType, setTerainType] = useState<number>(1);\n\tconst [worldIni, setWorldIni] = useState<string>(initialWorldIni);\n\n\tfunction openGen() {\n\t\tconst ini = `[Global Parameters]\nMap Power X=11\nMap Power Y=${size}\nGeoNet Power=6\nSection Size Power=8\nMinimal Square Power=4\n\n${worldIni}\n\n[Creation Parameters]\nBuild Scenario File=output.vsc\nMesh Value=${meshValue}\nNoise Amplitude=${amplitude}\nDefault Terrain Type=${terainType}\n`;\n\n\t\tprops.openGen(palette, ini, size)\n\t}\n\n\treturn <div>\n\t\t<div>\n\t\t\t<Callout>\n\t\t\t\t<h5>Generate World</h5>\n\t\t\t\t<p>Options</p>\n\t\t\t\t<div className=\"open-inputs\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label className=\"open-left-label\">Palette</label>\n\t\t\t\t\t\t<HTMLSelect minimal={false}\n\t\t\t\t\t\t\toptions={[\"ark-a-znoy\", \"boozeena\", \"fostral\", \"glorx\", \"hmok\", \"knox\", \"necross\", \"threall\", \"weexow\", \"xplo\", \"mirage\"]}\n\t\t\t\t\t\t\tonChange={(e) => setPalette(e.currentTarget.value)}\n\t\t\t\t\t\t\tvalue={palette} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"in-a-row\">\n\t\t\t\t\t\t<label className=\"open-left-label\">World size ({size})</label>\n\t\t\t\t\t\t<NumericInput className=\"short-input\" min={10} max={14} value={size} onValueChange={setSize} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"in-a-row\">\n\t\t\t\t\t\t<label className=\"open-left-label\">Mesh Value ({meshValue})</label>\n\t\t\t\t\t\t<NumericInput className=\"short-input\" min={1} max={200} value={meshValue} onValueChange={setMeshValue} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"in-a-row\">\n\t\t\t\t\t\t<label className=\"open-left-label\">Noise Amplitude ({amplitude})</label>\n\t\t\t\t\t\t<NumericInput className=\"short-input\" min={1} max={10} value={amplitude} onValueChange={setAmplitude} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"in-a-row\">\n\t\t\t\t\t\t<label className=\"open-left-label\">Terain Type ({terainType})</label>\n\t\t\t\t\t\t<NumericInput className=\"short-input\" min={0} max={7} value={terainType} onValueChange={setTerainType} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Button onClick={openGen}>Generate World</Button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label className=\"open-left-label\">Additional params</label><br />\n\t\t\t\t\t\t<TextArea className=\"open-textarea\" large={false} growVertically={true} value={worldIni} onChange={(e) => setWorldIni(e.target.value)} />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Callout>\n\t\t</div>\n\t</div>\n}\n\nconst initialWorldIni = `[Storage]\nVersion=1.4\nCompressed Format Using=0\nFile Name=output\nPalette File=harmony.pal\n\n[Rendering Parameters]\nShadow Offsets= 6 16 4 9 6 3 2 6\nHeight Shifts=  2 4 8 8 5 6 8 6\nBegin Colors=   1 32 64 72 88 104 112 120\nEnd Colors=    31 63 71 87 103 111 119 127\n\n[Dynamic Palette]\nWave Terrain=0\nTerrain Number=3\nTerrains= 5 4 6\nSpeeds= 128 128 256\nAmplitudes= 32 8 32\nRed= 1 1 1\nGreen= 0 1 1\nBlue= 0 0 0\n\n[Lighting Cycle Dynamic Palette]\nWave Terrain=0\nTerrain Number=3\nTerrains= 5 4 6\nSpeeds= 128 128 256\nAmplitudes= 32 8 32\nRed= 1 1 1\nGreen= 0 1 1\nBlue= 0 0 0\n`;","\nimport {\n\tButton, Callout, FileInput\n} from '@blueprintjs/core';\nimport React, { useState } from 'react';\nimport { AppProps } from \"./router\";\n\nexport function Zip(props: AppProps) {\n\tconst [zipFile, setZipFile] = useState<File | undefined>(undefined);\n\tconst [busy, setBusy] = useState<boolean>(false);\n\tfunction onFileChange(e: any) {\n\t\tsetZipFile(e.target.files[0]);\n\t}\n\n\tasync function restore() {\n\t\tif (zipFile === undefined || busy) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetBusy(true);\n\t\tconst zipContents = await readContents(zipFile);\n\t\tprops.openZip(zipContents);\n\t}\n\n\treturn <div>\n\t\t<Callout>\n\t\t\t<h5>Restore world from ZIP</h5>\n\t\t\t<p className=\"try-zip\">Try (<a href=\"worlds/satadi.zip\">satadi.zip</a>) OR (<a href=\"worlds/empty.zip\">empty.zip</a>)</p>\n\t\t\t<div className=\"open-inputs\">\n\t\t\t\t<FileInput hasSelection={zipFile !== undefined} text={zipFile ? zipFile.name : \"Select 'zip' File\"} \n\t\t\t\t\tonChange={onFileChange}/>\n\t\t\t\t<Button disabled={!zipFile || busy} onClick={restore}>Restore</Button>\n\t\t\t</div>\n\t\t</Callout>\n\t</div>;\n}\n\nasync function readContents(file: File) {\n\tconst reader = new FileReader();\n\n\treturn new Promise<Uint8Array>((resolve, reject) => {\n\t\treader.addEventListener('load', (event) => {\n\t\t\tresolve(new Uint8Array(reader.result as ArrayBuffer));\n\t\t})\n\t\treader.readAsArrayBuffer(file);\n\t})\n}","import {\n\tAlignment, AnchorButton, Card, Collapse, Elevation, Intent, Navbar\n} from '@blueprintjs/core';\nimport React, { useState } from 'react';\nimport { Gen } from './gen';\nimport { Zip } from './zip';\nimport \"./landing.css\";\nimport { AppProps } from './router';\n\nexport function Landing(props: AppProps) {\n\tconst [opened, setOpened] = useState<string>(\"\");\n\n\treturn <div className=\"landing-menu\">\n\t\t<Navbar>\n\t\t\t<Navbar.Group align={Alignment.LEFT}>\n\t\t\t\t<Navbar.Heading>SurWeb</Navbar.Heading>\n\t\t\t\t<Navbar.Divider />\n\t\t\t\t<Navbar.Heading><a href=\"https://caiiiycuk.github.io/vangers-web/\">vangers-web</a></Navbar.Heading>\n\t\t\t</Navbar.Group>\n\t\t</Navbar>\n\t\t<Card interactive={true} elevation={Elevation.TWO}>\n\t\t\t<div className=\"start-options\">\n\t\t\t\t<div className=\"open-option\">\n\t\t\t\t\t<AnchorButton minimal={true} intent={Intent.PRIMARY} onClick={() => props.openLastSession()}>Open SurWeb last session</AnchorButton>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"open-or\">\n\t\t\t\t\tOR\n\t\t\t\t</div>\n\t\t\t\t{\n\t\t\t\t\topened !== \"gen\" ?\n\t\t\t\t\t\t<div className=\"open-option\">\n\t\t\t\t\t\t\t<AnchorButton intent={Intent.PRIMARY} minimal={true} onClick={() => setOpened(\"zip\")}>Restore from ZIP</AnchorButton>\n\t\t\t\t\t\t</div> :\n\t\t\t\t\t\tnull\n\t\t\t\t}\n\t\t\t\t<Collapse isOpen={opened === \"zip\"}>\n\t\t\t\t\t<Zip {...props} />\n\t\t\t\t</Collapse>\n\t\t\t\t<div className=\"open-or\">\n\t\t\t\t\tOR\n\t\t\t\t</div>\n\t\t\t\t{\n\t\t\t\t\topened !== \"gen\" ?\n\t\t\t\t\t\t<div className=\"open-option\">\n\t\t\t\t\t\t\t<AnchorButton intent={Intent.PRIMARY} minimal={true} onClick={() => setOpened(\"gen\")}>Generate world</AnchorButton>\n\t\t\t\t\t\t</div> :\n\t\t\t\t\t\tnull\n\t\t\t\t}\n\t\t\t\t<Collapse isOpen={opened === \"gen\"}>\n\t\t\t\t\t<Gen {...props} />\n\t\t\t\t</Collapse>\n\t\t\t</div>\n\t\t</Card>\n\t</div>;\n}\n","import React, { useState } from \"react\";\nimport { Landing } from \"./landing\";\nimport { SurWeb } from \"./surweb\";\n\n\nexport interface AppProps {\n\troute: string,\n\n\tgen: GenProps | null,\n\topenGen: (palette: string, worldIni: string, size: number) => void;\n\n\tzip: Uint8Array | null,\n\topenZip: (zip: Uint8Array) => void;\n\n\topenLastSession: () => void;\n\n\tgetVmp: () => Uint8Array | undefined;\n\tsetVmp: (vmp: Uint8Array) => void;\n}\n\nexport interface GenProps {\n\tpalette: string,\n\tworldIni: string,\n\tsize: number,\n}\n\nexport function AppRouter() {\n\tconst [route, setRoute] = useState<string>(\"\");\n\tconst [gen, setGen] = useState<GenProps|null>(null);\n\tconst [zip, setZip] = useState<Uint8Array|null>(null);\n\n\tconst props: AppProps = {\n\t\troute,\n\t\tgen,\n\t\topenGen: (palette: string, worldIni: string, size: number) => {\n\t\t\tsetGen({ palette, worldIni, size});\n\t\t\tsetRoute(\"gen\");\n\t\t},\n\t\tzip,\n\t\topenZip: (zip: Uint8Array) => {\n\t\t\tsetZip(zip);\n\t\t\tsetRoute(\"zip\");\n\t\t},\n\t\topenLastSession: () => {\n\t\t\tsetRoute(\"lastSession\");\n\t\t},\n\t\tsetVmp: (vmp: Uint8Array) => {},\n\t\tgetVmp: () => undefined,\n\t};\n\n\tif (route.length > 0) {\n\t\treturn <SurWeb {...props} />\n\t} else {\n\t\treturn <Landing {...props} />;\n\t}\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport \"@blueprintjs/core/lib/css/blueprint.css\";\n\nimport './index.css';\nimport { AppRouter } from './router';\n\nReactDOM.render(\n  <React.StrictMode>\n    <AppRouter />\n  </React.StrictMode>,\n  document.getElementById('root')\n);","export async function resolveUrl(url: string,\n                                 onProgress?: (progress: number) => void): Promise<Uint8Array> {\n    return new Promise<Uint8Array>((resolve, reject) => {\n        const request = new XMLHttpRequest();\n        request.open(\"GET\", url, true);\n        request.overrideMimeType(\"text/plain; charset=x-user-defined\");\n        request.addEventListener(\"error\", (evt) => {\n            reject(new Error(\"Network error, can't download \" + url));\n        });\n        request.addEventListener(\"abort\", () => {\n            reject(new Error(\"Request canceled for url \" + url));\n        }, false);\n        request.responseType = \"arraybuffer\";\n        request.onreadystatechange = () => {\n            if (request.readyState === 4) {\n                if (request.status === 200) {\n                    if (onProgress !== undefined) {\n                        onProgress(100);\n                    }\n                    resolve(new Uint8Array(request.response));\n                } else {\n                    reject(new Error(\"Network error, can't download \" + url));\n                }\n            }\n        };\n        if (onProgress !== undefined) {\n            request.onprogress = (event) => {\n                if (event.total && event.total > 0) {\n                    const porgress = Math.round(event.loaded * 10000 / event.total) / 100;\n                    onProgress(porgress);\n                }\n            }\n        }\n        request.send();\n    });\n}\n","import { Alignment, AnchorButton, Button, FileInput, Intent, Navbar, ResizeEntry, ResizeSensor, Spinner, Overlay } from \"@blueprintjs/core\";\nimport React, { useEffect, useRef, useState } from 'react';\nimport { Ron } from \"./ron\";\nimport { AppProps } from './router';\nimport './surweb.css';\nimport { resolveUrl } from './xhr';\nimport { worldFile, palFile, bitmapFolder, shapeFolder } from \"./config\";\n\n\nconst WIDTH = 1280;\nconst HEIGHT = 720;\n\ntype Binaries = { dataJs: Uint8Array, data: Uint8Array, wasm: Uint8Array, wasmJs: Uint8Array };\n\nexport function SurWeb(props: AppProps) {\n  const module = useState<any>({})[0];\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [canvas, setCanvas] = useState<HTMLCanvasElement | null>(null);\n  const [progress, setProgress] = useState<number>(0);\n  const [binaries, setBinaries] = useState<Binaries | null>(null);\n  const [loaded, setLoaded] = useState<boolean>(false);\n  const [archiveUrl, setArchiveUrl] = useState<string | null>(null);\n  const [fileProgress, setFileProgress] = useState<number>(0);\n  const [reader, setReader] = useState<FileReader | null>(null);\n  const [ron, setRon] = useState<boolean>(false);\n\n  useEffect(() => {\n    async function doLoad() {\n      const [dataJs, data, wasm, wasmJs] = await Promise.all([\n        resolveUrl(\"surmap/bin.data.js\", setProgress),\n        resolveUrl(\"surmap/bin.data\", setProgress),\n        resolveUrl(\"surmap/surmap.wasm\"),\n        resolveUrl(\"surmap/surmap.js\")]);\n\n      setBinaries({ dataJs, data, wasm, wasmJs });\n    };\n\n    doLoad().catch(console.error);\n  }, []);\n\n  useEffect(() => {\n    if (canvasRef.current !== null) {\n      const canvas = canvasRef.current;\n      const rect = (canvas.parentElement as HTMLElement).getBoundingClientRect();\n      setCanvas(canvas);\n\n      canvas.width = WIDTH;\n      canvas.height = HEIGHT;\n      resizeCanvas(canvas, rect.width, rect.height);\n    }\n  }, [canvasRef]);\n\n  useEffect(() => {\n    if (canvas === null || binaries === null) {\n      return;\n    }\n\n    instantiateWasm(canvas, binaries, module, onArchive, props)\n      .then(() => setLoaded(true))\n      .catch(console.error);\n\n    // eslint-disable-next-line\n  }, [canvas, binaries, module]);\n\n  function onResize(e: ResizeEntry[]) {\n    if (canvas !== null) {\n      resizeCanvas(canvas, e[0].contentRect.width, e[0].contentRect.height);\n    }\n  }\n\n  function onArchive(archive: Uint8Array) {\n    if (archiveUrl !== null) {\n      URL.revokeObjectURL(archiveUrl);\n    }\n\n    const blob = new Blob([archive], {\n      type: \"application/zip\"\n    });\n    const url = URL.createObjectURL(blob);\n    setArchiveUrl(url);\n    // downloadUrl(url);\n  }\n\n  function onDownload() {\n    canvas?.focus();\n\n    if (archiveUrl !== null) {\n      downloadUrl(archiveUrl);\n    }\n  }\n\n  function onUpload(e: any) {\n    canvas?.focus();\n\n    const files = e.currentTarget.files as FileList;\n    if (files.length === 0) {\n      setReader(null);\n      return;\n    }\n\n    const file = files[0];\n    const reader = new FileReader();\n    reader.addEventListener(\"load\", async (e) => {\n      const bytes = new Uint8Array(reader.result as ArrayBuffer);\n      const FS = module.FS;\n      const root = FS.cwd() + \"/\";\n      if (file.name.endsWith(\".bmp\") || file.name.endsWith(\".pal\")) {\n        try {\n          FS.unlink(root + bitmapFolder + file.name);\n        } catch {\n          //\n        }\n        FS.createDataFile(root, bitmapFolder + file.name, bytes, true, true, true);\n        FS.syncfs((err: any) => { });\n        alert(\"Ok\");\n      } else if (file.name.endsWith(\".c3d\")) {\n        try {\n          FS.unlink(root + shapeFolder + file.name);\n        } catch {\n          //\n        }\n        FS.createDataFile(root, shapeFolder + file.name, bytes, true, true, true);\n        FS.syncfs((err: any) => { });\n        alert(\"Ok\");\n      } else {\n        alert(\"Only bmp / c3d / pal files are supported\");\n      }\n      setReader(null);\n    });\n    reader.addEventListener(\"progress\", (e) => setFileProgress(e.loaded / e.total));\n    reader.readAsArrayBuffer(file);\n    setReader(reader);\n  }\n\n  return (\n    <div className=\"surweb-container\">\n      <Navbar>\n        <Navbar.Group align={Alignment.LEFT}>\n          <Navbar.Heading><AnchorButton intent={Intent.PRIMARY} minimal={true} onClick={() => window.location.reload()}>SurWeb</AnchorButton></Navbar.Heading>\n          <Navbar.Divider />\n          {\n            loaded ?\n              <div className=\"file-container\">\n                <FileInput disabled={reader !== null} text=\"Add file\" onInputChange={onUpload} />\n                &nbsp;&nbsp;\n                <Spinner size={16} intent={Intent.PRIMARY} value={fileProgress} />\n              </div> :\n              <Navbar.Heading>Loading {progress}%</Navbar.Heading>\n          }\n          {loaded ?\n            <Button minimal={true} onKeyDown={() => { }} onClick={() => setRon(!ron)}>RON</Button> :\n            null\n          }\n          {\n            archiveUrl !== null ?\n              <Button intent={Intent.PRIMARY} onKeyDown={() => { }} minimal={true} onClick={onDownload}>Download ZIP</Button> :\n              null\n          }\n        </Navbar.Group>\n      </Navbar>\n      <ResizeSensor onResize={onResize}>\n        <div className=\"canvas-container\">\n          <canvas id=\"canvas\" ref={canvasRef} tabIndex={0}></canvas>\n          {loaded ? null : <div className=\"spinner-container\"><Spinner size={64} /></div>}\n        </div>\n      </ResizeSensor>\n      <Overlay isOpen={ron} lazy={true} hasBackdrop={false}>\n        <Ron {...props} Module={module} close={() => setRon(false)} />\n      </Overlay>\n    </div>\n  );\n}\n\nfunction instantiateWasm(canvas: HTMLCanvasElement,\n  binaries: Binaries,\n  Module: any,\n  onArchive: (archive: Uint8Array) => void,\n  props: AppProps) {\n  return new Promise<void>((resolve, reject) => {\n    try {\n      Module.saveZip = (archive: Uint8Array) => {\n        Module.FS.syncfs((err: any) => { });\n        onArchive(archive);\n      }\n      Module.canvas = canvas;\n      Module.instantiateWasm = async (info: any, receiveInstance: any) => {\n        const wasmModule = await WebAssembly.compile(binaries.wasm);\n        const instance = await WebAssembly.instantiate(wasmModule, info);\n        receiveInstance(instance, wasmModule);\n      };\n\n      Module.onRuntimeInitialized = () => {\n        instantiateProps(Module, props, binaries).then((args) => {\n          setTimeout(() => {\n            Module.callMain(args);\n            resolve();\n          }, 16);\n        }).catch(console.error);\n      };\n\n      const decoder = new TextDecoder();\n      const moduleFn = new (Function as any)([\"Module\"], decoder.decode(binaries.wasmJs));\n      moduleFn(Module);\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n\nfunction instantiateProps(Module: any, props: AppProps, binaries: Binaries): Promise<string[]> {\n  return new Promise<string[]>((resolve, reject) => {\n    Module.FS.chdir(\"/idbfs\");\n    Module.FS.syncfs(true, (err: any) => {\n      const root = Module.FS_cwd() + \"/\";\n\n      try {\n        Module.FS.lookupPath(root + worldFile);\n      } catch (e) {\n        // recreate FS\n        Module.getPreloadedPackage = (name: any, size: any) => binaries.data.buffer;\n        // eslint-disable-next-line\n        eval(new TextDecoder().decode(binaries.dataJs));\n        Module.FS.syncfs(() => { });\n      }\n\n      if (props.route === \"gen\" && props.gen !== null) {\n        (window as any).m = Module;\n        const enc = new TextEncoder();\n        Module.FS.unlink(root + worldFile);\n        Module.FS.createDataFile(root, worldFile, enc.encode(props.gen.worldIni), true, true, true);\n        if (props.gen.palette !== \"mirage\") {\n          Module.FS.unlink(root + palFile);\n          const data = Module.FS.readFile(root + \"_palette/\" + props.gen.palette + \".pal\");\n          Module.FS.createDataFile(root, palFile, data, true, true, true);\n        }\n        resolve([\"/I\" + props.gen.size, \"/G0\"]);\n      } else if (props.route === \"zip\" && props.zip !== null) {\n        Module.FS.chdir(root + \"thechain/mirage/\");\n        const bytes = props.zip;\n        const buffer = Module._malloc(bytes.length);\n        Module.HEAPU8.set(bytes, buffer);\n        Module._zip_to_fs(buffer, bytes.length);\n        Module._free(buffer);\n        Module.FS.chdir(root);\n        resolve([]);\n      } else {\n        resolve([]);\n      }\n    });\n  });\n}\n\nfunction resizeCanvas(canvas: HTMLCanvasElement, innerWidth: number, innerHeight: number) {\n  const [width, height] = getSizeWithAspectRatio(innerWidth, innerHeight, WIDTH / HEIGHT);\n\n  canvas.style.position = \"relative\";\n  canvas.style.top = (innerHeight / 2) + \"px\";\n  canvas.style.left = (innerWidth / 2) + \"px\";\n  canvas.style.marginTop = (-1) * (height / 2) + \"px\";\n  canvas.style.marginLeft = (-1) * (width / 2) + \"px\";\n  canvas.style.width = width + \"px\";\n  canvas.style.height = height + \"px\";\n}\n\nfunction getSizeWithAspectRatio(width: number, height: number, targetAspect: number) {\n  const screenAspect = width / height;\n  if (screenAspect === targetAspect) {\n    return [width, height];\n  }\n  const calculatedWidth = Math.round(height * targetAspect);\n  if (calculatedWidth <= width) {\n    return [calculatedWidth, height];\n  }\n  const calculatedHeight = Math.round(width / targetAspect);\n  return [width, calculatedHeight];\n}\n\nfunction downloadUrl(url: string) {\n  const a = document.createElement(\"a\");\n  a.href = url;\n  a.download = \"world.zip\";\n  a.style.display = \"none\";\n  document.body.appendChild(a);\n\n  a.click();\n  a.remove();\n}","import {\n\tButton, Callout, FileInput, Spinner, Card, Icon\n} from '@blueprintjs/core';\nimport React, { useState } from 'react';\nimport { AppProps } from './router';\nimport { worldFile, palFile, vmpFile, vprFile } from \"./config\";\n\nimport \"./ron.css\";\n\ndeclare function ron2vmp(ron_multi_png: Uint8Array, height_png: Uint8Array, material_hi_png: Uint8Array, material_lo_png: Uint8Array): Uint8Array;\ndeclare function vmp2ron(ini: string, vmp: Uint8Array, vpr: Uint8Array, palette: Uint8Array): void;\ndeclare function get_ron_multi_png(): Uint8Array;\ndeclare function get_height_png(): Uint8Array;\ndeclare function get_material_hi_png(): Uint8Array;\ndeclare function get_material_lo_png(): Uint8Array;\n\nexport interface RonProps extends AppProps {\n\tModule: any;\n\tclose: () => void;\n}\n\nexport function Ron(props: RonProps) {\n\tconst [ronFile, setRonFile] = useState<File | undefined>(undefined);\n\tconst [heightFile, setHeightFile] = useState<File | undefined>(undefined);\n\tconst [hiFile, setHiFile] = useState<File | undefined>(undefined);\n\tconst [loFile, setLoFile] = useState<File | undefined>(undefined);\n\tconst [busy, setBusy] = useState<boolean>(false);\n\n\tconst [ronUrl, setRonUrl] = useState<string>(\"\");\n\tconst [heightUrl, setHeightUrl] = useState<string>(\"\");\n\tconst [hiUrl, setHiUrl] = useState<string>(\"\");\n\tconst [loUrl, setLoUrl] = useState<string>(\"\");\n\n\tfunction onFileChange(e: any, setFn: (f: File | undefined) => void) {\n\t\tsetFn(e.target.files[0]);\n\t}\n\n\tasync function updateWorld() {\n\t\tif (!(ronFile && heightFile && hiFile && loFile)) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetBusy(true);\n\t\tconst ron = await readContents(ronFile);\n\t\tconst height = await readContents(heightFile);\n\t\tconst hi = await readContents(hiFile);\n\t\tconst lo = await readContents(loFile);\n\t\tconst vmp = ron2vmp(ron, height, hi, lo);\n\n\t\tconst Module = props.Module;\n\t\tconst FS = Module.FS;\n\t\tconst root = FS.cwd() + \"/\";\n\t\tFS.unlink(root + vmpFile);\n\t\tFS.createDataFile(root, vmpFile, vmp, true, true, true);\n\t\tModule._reloadWorld();\n\t\tModule._updateZipArchive();\n\t\tsetBusy(false);\n\n\t\tprops.close();\n\t}\n\n\tasync function exportWorld() {\n\t\tsetBusy(true);\n\t\tsetTimeout(() => {\n\t\t\tconst Module = props.Module;\n\t\t\tconst FS = Module.FS;\n\n\t\t\tModule._updateZipArchive();\n\n\t\t\tconst root = FS.cwd() + \"/\";\n\t\t\tconst ini = new TextDecoder().decode(FS.readFile(root + worldFile));\n\t\t\tconst vmp = FS.readFile(root + vmpFile);\n\t\t\tconst vpr = FS.readFile(root + vprFile);\n\t\t\tconst pal = FS.readFile(root + palFile);\n\n\t\t\tvmp2ron(ini, vmp, vpr, pal);\n\n\t\t\tconst ron = get_ron_multi_png();\n\t\t\tconst height = get_height_png();\n\t\t\tconst hi = get_material_hi_png();\n\t\t\tconst lo = get_material_lo_png();\n\n\t\t\tif (ronUrl.length > 0) {\n\t\t\t\tURL.revokeObjectURL(ronUrl);\n\t\t\t\tURL.revokeObjectURL(heightUrl);\n\t\t\t\tURL.revokeObjectURL(hiUrl);\n\t\t\t\tURL.revokeObjectURL(loUrl);\n\t\t\t}\n\n\t\t\tsetRonUrl(URL.createObjectURL(new Blob([ron], { type: \"text\" })));\n\t\t\tsetHeightUrl(URL.createObjectURL(new Blob([height], { type: \"image/png\" })));\n\t\t\tsetHiUrl(URL.createObjectURL(new Blob([hi], { type: \"image/png\" })));\n\t\t\tsetLoUrl(URL.createObjectURL(new Blob([lo], { type: \"image/png\" })));\n\n\t\t\tconsole.log(ron, height, hi, lo);\n\t\t\tsetBusy(false);\n\t\t}, 100);\n\t}\n\n\treturn <Card>\n\t\t<div className=\"ron-container\">\n\t\t\t<div>\n\t\t\t\t{busy ?\n\t\t\t\t\t<Spinner /> :\n\t\t\t\t\t<Callout>\n\t\t\t\t\t\t<h5>Export WROLD to RON</h5>\n\t\t\t\t\t\t<div className=\"open-inputs\">\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tronUrl.length > 0 ?\n\t\t\t\t\t\t\t\t\t<Button className=\"ron-download\" onKeyDown={() => { }} minimal={true} onClick={() => downloadUrl(ronUrl, \"world.ron\")}>Download RON</Button> :\n\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\theightUrl.length > 0 ?\n\t\t\t\t\t\t\t\t\t<Button className=\"ron-download\" onKeyDown={() => { }} minimal={true} onClick={() => downloadUrl(heightUrl, \"height.png\")}>Download height PNG</Button> :\n\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thiUrl.length > 0 ?\n\t\t\t\t\t\t\t\t\t<Button className=\"ron-download\" onKeyDown={() => { }} minimal={true} onClick={() => downloadUrl(hiUrl, \"material_hi.png\")}>Download material HI PNG</Button> :\n\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tloUrl.length > 0 ?\n\t\t\t\t\t\t\t\t\t<Button className=\"ron-download\" onKeyDown={() => { }} minimal={true} onClick={() => downloadUrl(loUrl, \"material_lo.png\")}>Download material LO PNG</Button> :\n\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t<Button onClick={exportWorld}>Export world</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Callout>\n\t\t\t\t}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t{busy ?\n\t\t\t\t\t<Spinner /> :\n\t\t\t\t\t<Callout>\n\t\t\t\t\t\t<h5>Update WORLD using RON</h5>\n\t\t\t\t\t\t<p>Provide files</p>\n\t\t\t\t\t\t<div className=\"open-inputs\">\n\t\t\t\t\t\t\t<FileInput hasSelection={ronFile !== undefined} text={ronFile ? ronFile.name : \"Select 'ron' File\"}\n\t\t\t\t\t\t\t\tonInputCapture={(e) => onFileChange(e, setRonFile)} />\n\t\t\t\t\t\t\t<FileInput hasSelection={heightFile !== undefined} text={heightFile ? heightFile.name : \"Select 'height' File\"}\n\t\t\t\t\t\t\t\tonInputCapture={(e) => onFileChange(e, setHeightFile)} />\n\t\t\t\t\t\t\t<FileInput hasSelection={hiFile !== undefined} text={hiFile ? hiFile.name : \"Select 'material_hi' File\"}\n\t\t\t\t\t\t\t\tonInputCapture={(e) => onFileChange(e, setHiFile)} />\n\t\t\t\t\t\t\t<FileInput hasSelection={loFile !== undefined} text={loFile ? loFile.name : \"Select 'material_lo' File\"}\n\t\t\t\t\t\t\t\tonInputCapture={(e) => onFileChange(e, setLoFile)} />\n\t\t\t\t\t\t\t<Button disabled={!(ronFile && heightFile && hiFile && loFile)} onClick={updateWorld}>Update world</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Callout>\n\t\t\t\t}\n\t\t\t</div>\n\t\t\t<Icon className=\"ron-close\" icon=\"cross\" onClick={() => props.close()} />\n\t\t</div>\n\t\t<div className=\"ron-powered-by\">Powered by <a rel=\"noreferrer\" href=\"https://github.com/kvark/vange-rs/wiki/Resource-Converter\" target=\"_blank\">vanger-rs converter</a></div>\n\t</Card>\n}\n\nasync function readContents(file: File) {\n\tconst reader = new FileReader();\n\n\treturn new Promise<Uint8Array>((resolve, reject) => {\n\t\treader.addEventListener('load', (event) => {\n\t\t\tresolve(new Uint8Array(reader.result as ArrayBuffer));\n\t\t})\n\t\treader.readAsArrayBuffer(file);\n\t})\n}\n\nfunction downloadUrl(url: string, name: string) {\n\tconst a = document.createElement(\"a\");\n\ta.href = url;\n\ta.download = name;\n\ta.style.display = \"none\";\n\tdocument.body.appendChild(a);\n\n\ta.click();\n\ta.remove();\n}"],"sourceRoot":""}